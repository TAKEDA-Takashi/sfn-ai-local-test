# Zodスキーマとembedded-types.tsの同期について

## 重要な保守事項

### ファイルの関係性
- **Zodスキーマ（真実の源）**: 
  - `src/schemas/test-schema.ts` - テストスイート定義
  - `src/schemas/mock-schema.ts` - モック設定定義
- **AI用型定義（手動管理）**: 
  - `src/ai/agents/embedded-types.ts` - AI生成用の型定義

### 同期が必要なタイミング
Zodスキーマに以下の変更を加えた場合、`embedded-types.ts`の手動更新が必要：
1. 新しいフィールドの追加
2. 既存フィールドの型変更
3. フィールドの削除
4. 新しいインターフェースの追加

### 更新手順
1. Zodスキーマを変更
2. `src/ai/agents/embedded-types.ts`の対応する型定義を手動で更新
3. モック用（`MOCK_TYPE_DEFINITIONS`）とテスト用（`TEST_TYPE_DEFINITIONS`）の分離を維持
4. AIフレンドリーなコメントを追加（各フィールドの用途を説明）

### 設計の背景
- **自動生成を断念した理由**: Zodの`z.infer`はコンパイル時のみ存在し、実行時に型情報を抽出できない
- **手動管理を選択した理由**: スキーマ変更頻度が低く、手動更新のコストが許容範囲内
- **分離の理由**: モック生成とテスト生成でAIに与える情報を最適化し、生成精度を向上

### 注意事項
⚠️ **この同期を忘れると、AI生成機能が古い型定義を使用し、不正なYAMLを生成する可能性がある**

### チェックリスト
スキーマ変更時の確認事項：
- [ ] Zodスキーマを更新した
- [ ] embedded-types.tsの対応する部分を更新した
- [ ] AIフレンドリーなコメントを追加/更新した
- [ ] npm run typecheckでエラーがない
- [ ] npm run lintでエラーがない
- [ ] npm testでAI生成関連のテストが通る